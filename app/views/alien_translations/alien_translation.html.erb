<%# Give the <body> tag a page-specific class so global styles in the layout can skip this page %>
  <% content_for :body_class, "alien-translations-page" %>

    <!-- Full-viewport star container -->
    <div id="starfield" aria-hidden="true"></div>

    <style>
      /* Title styling (the big Alien Translations) */
      .game-title {
        text-align: center;
        font-family: 'Bangers', cursive;
        font-size: 128px;

        /* Gradient fill clipped to text for the arcade look */
        background: linear-gradient(to bottom, #ffcc00, #ff3300);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        color: transparent;

        /* Offset shadows for a neon outline effect */
        text-shadow:
          3px 3px 0 #ffffff,
          -3px -3px 0 #5cfaf5,
          3px -3px 0 #41f2ec,
          -3px 3px 0 #69edf9;

        margin-top: 20px;
        margin-bottom: 60px;
      }

      /* Page content defaults */
      .page-wrap {
        text-align: center;
        color: #ffffff;
        font-family: Arial, sans-serif;
      }

      /* Styles the input where I type my guess */
      .page-wrap input[type="text"] {
        background: #fff;
        color: #000;
        border: 2px solid #000;
        padding: 6px 8px;
        border-radius: 6px;
        font-size: 18px;
      }

      /* Buttons: generic, hint, and submit (scoped so global .btn styles don't clash) */
      .page-wrap button:not(.btn),
      .page-wrap input[type="submit"]:not(.btn),
      .page-wrap a.btn:not(.btn) {
        background: rgb(242, 96, 70);
        color: #fff;
        border: 2px solid #000000;
        padding: 8px 16px;
        font-size: 16px;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color .3s, transform .05s;
        text-decoration: none;
      }

      /* Hover state for buttons */
      .page-wrap button:not(.btn):hover,
      .page-wrap input[type="submit"]:not(.btn):hover,
      .page-wrap a.btn:not(.btn):hover {
        background: #629deb;
        border-color: #000;
      }

      /* Click press effect */
      .page-wrap button:not(.btn):active,
      .page-wrap input[type="submit"]:not(.btn):active {
        transform: translateY(1px);
      }

      .btn-group .btn.active {
        filter: brightness(.92);
        outline: 2px solid #000;
      }

      .page-wrap p,
      .page-wrap label {
        font-size: 18px;
      }

      /* Difficulty pill styling with per-level colours */
      #current-difficulty {
        display: block;
        width: fit-content;
        margin: 10px auto 6px;
        padding: 8px 14px;
        border-radius: 999px;
        font-weight: 800;
        letter-spacing: .8px;
        text-transform: uppercase;
        text-shadow: 1px 1px 0 #000;
        border: 2px solid #000;
        box-shadow: 0 6px 0 rgba(0, 0, 0, .25);
        backdrop-filter: blur(2px);
      }

      #current-difficulty.difficulty-easy {
        background: rgba(40, 167, 69, .2);
        color: #9ef7b1;
        border-color: #1b5e20;
      }

      #current-difficulty.difficulty-normal {
        background: rgba(0, 123, 255, .2);
        color: #b6d8ff;
        border-color: #0d47a1;
      }

      #current-difficulty.difficulty-hard {
        background: rgba(220, 53, 69, .2);
        color: #ffb3b8;
        border-color: #7f1d1d;
      }

      /* Difficulty buttons (works even without Bootstrap) */
      #difficulty-buttons {
        margin-bottom: 10px;
      }

      #difficulty-buttons .btn-group {
        display: inline-flex;
        /* line up horizontally */
        gap: 10px;
        /* space between buttons */
        align-items: center;
        justify-content: center;
      }

      #difficulty-buttons .btn-group form {
        display: inline-block;
        /* each Rails `button_to` form stays inline */
        margin: 0;
      }

      #difficulty-buttons .btn {
        display: inline-block;
        padding: 8px 14px;
        border-radius: 8px;
        border: 2px solid #000;
        font-weight: 700;
        letter-spacing: .5px;
        cursor: pointer;
        color: #fff;
        box-shadow: 0 4px 0 rgba(0, 0, 0, .25);
        transition: filter .15s ease;
      }

      /* colours for each difficulty */
      #difficulty-buttons .btn-success {
        background: #28a745;
      }

      /* Easy  */
      #difficulty-buttons .btn-primary {
        background: #0d6efd;
      }

      /* Normal */
      #difficulty-buttons .btn-danger {
        background: #dc3545;
      }

      /* Hard   */

      #difficulty-buttons .btn:hover {
        filter: brightness(.92);
      }

      #difficulty-buttons .btn.active {
        outline: 2px solid #000;
      }


      /* Score badges */
      #best-score,
      #run-score {
        display: inline-block;
        margin: 8px 6px 6px;
        padding: 6px 12px;
        border-radius: 10px;
        font-weight: 800;
        letter-spacing: .6px;
        text-transform: uppercase;
        background: rgba(255, 255, 255, .15);
        color: #fefefe;
        border: 2px solid #000;
        box-shadow: 0 4px 0 rgba(0, 0, 0, .25);
      }

      #best-score .value {
        color: #ffe066;
      }

      #run-score .value {
        color: #f8b4ff;
      }

      /* Placeholder where I show a “new best” badge if needed */
      #new-best {
        min-height: 24px;
        margin: 4px 0 16px;
      }

      .new-best {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 999px;
        background: #ffd54f;
        color: #000;
        font-weight: 900;
        border: 2px solid #000;
        box-shadow: 0 4px 0 rgba(0, 0, 0, .25);
        animation: pulse .9s ease-in-out 2;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }

        50% {
          transform: scale(1.06);
        }

        100% {
          transform: scale(1);
        }
      }

      /* Dynamic star field layer (no background gradient) */
      #starfield {
        position: fixed;
        /* stays put even if the page scrolls */
        inset: 0;
        /* top/right/bottom/left: 0 */
        z-index: -1;
        /* behind all page content */
        pointer-events: none;
        /* never intercept clicks */
      }

      #starfield .star {
        position: absolute;
        width: 2px;
        /* base size; JS varies this per star */
        height: 2px;
        background: #fff;
        border-radius: 50%;
        opacity: 0.9;
      }
    </style>

    <div class="page-wrap">
      <h1 class="game-title">Alien Translations</h1>

      <!-- Difficulty buttons rendered with the current session difficulty -->
      <%= render "alien_translations/difficulty_buttons" , locals: { difficulty: (session[:difficulty] ||
        :normal).to_sym } %>

        <!-- High score badge -->
        <p id="best-score">
          High Score:
          <span class="value">
            <%= @best_score.present? ? @best_score : "—" %>
          </span>
        </p>

        <!-- Current run score badge -->
        <p id="run-score">
          Run Score:
          <span class="value">
            <%= @run_score.present? ? @run_score : "0" %>
          </span>
        </p>

        <!-- Where I’ll inject “New Best!” feedback when needed -->
        <div id="new-best"></div>

        <!-- Main game content (puzzle, hint, etc.) -->
        <%= render partial: "alien_translations/game_content" , locals: { puzzle: @puzzle, hint: @hint, difficulty:
          session[:difficulty] } %>
    </div>

    <!-- Small click sound for UX when changing difficulty -->
    <audio id="click-sound" preload="auto">
      <source src="<%= asset_path('mouse_click.mp3') %>" type="audio/mpeg">
    </audio>

    <script>
      (function () {
        const sel = 'button,[type="button"],[type="submit"],a,.btn';

        function audioEl() {
          return document.getElementById('click-sound');
        }

        // Prime/unlock the audio once after the first user gesture.
        function primeAudio() {
          const a = audioEl(); if (!a) return;
          a.volume = 1.0;
          a.load();

          const unlock = () => {
            // Try to start then immediately pause to satisfy autoplay policies.
            a.play().then(() => a.pause()).catch(() => { });
            window.removeEventListener('pointerdown', unlock, { capture: true });
          };

          window.addEventListener('pointerdown', unlock, { once: true, capture: true });
        }

        function playClick() {
          const a = audioEl(); if (!a) return;
          try { a.currentTime = 0; a.play(); } catch (_) { }
        }

        function wireClickSounds() {
          document.querySelectorAll(sel).forEach((el) => {
            if (el.dataset.soundWired || el.matches('[data-silent]')) return;
            el.dataset.soundWired = '1';
            el.addEventListener('click', playClick);
          });
        }

        document.addEventListener('turbo:load', () => { primeAudio(); wireClickSounds(); });
        document.addEventListener('turbo:render', wireClickSounds);
        document.addEventListener('turbo:frame-load', wireClickSounds);
      })();
    </script>



    <script>
      // Builds a random star field once per page view.
      // Guard with data-built to avoid duplicates on Turbo renders.
      function buildStarfield() {
        const el = document.getElementById('starfield');
        if (!el || el.dataset.built) return; // prevent re-building
        el.dataset.built = '1';

        const STAR_COUNT = 900; // adjust to change star density
        const frag = document.createDocumentFragment();
        const vw = window.innerWidth;
        const vh = window.innerHeight;

        for (let i = 0; i < STAR_COUNT; i++) {
          const s = document.createElement('span');
          s.className = 'star';

          // Random position across the current viewport in pixels
          s.style.left = (Math.random() * vw) + 'px';
          s.style.top = (Math.random() * vh) + 'px';

          // Random size with a bias toward small stars
          const r = Math.random();
          const size = r < 0.70 ? 1 : (r < 0.95 ? 2 : 3);
          s.style.width = size + 'px';
          s.style.height = size + 'px';

          // Slight variation in brightness
          s.style.opacity = (0.6 + Math.random() * 0.4).toFixed(2);

          frag.appendChild(s);
        }

        el.appendChild(frag);
      }

      // Works with Turbo; also supports plain DOMContentLoaded if Turbo isn’t present
      document.addEventListener('turbo:load', buildStarfield);
      if (document.readyState !== 'loading') {
        buildStarfield();
      } else {
        document.addEventListener('DOMContentLoaded', buildStarfield);
      }
    </script>